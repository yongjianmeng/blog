# 并发与并行的区别 #

## 声明 ##

以下内容除标注外均为个人理解，部分图片来自网络，侵删。欢迎讨论。


## 如何理解并发（Concurrency) 
并发是指**从代码逻辑上看**（从宏观角度，或者从程序员角度）多个任务是同时执行的，但**从硬件执行方式上看**（从微观角度）多个任务是在同一个 CPU 内核上按细分的时间片轮流(交替)执行，即多个任务仍然是按细粒度的串行执行。由于多个任务可以在单个核上交替执行，因此并发程序并不需要多核处理器也可以执行。如下图所示：
![](https://github.com/yongjianmeng/blog/blob/master/images/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C%E7%9A%84%E5%8C%BA%E5%88%AB-0.png)

## 如何理解并行（Parallelism） ##
**并行指的是一种物理运行状态**。区别于串行，并行能把多个任务真正地分配到不同的 CPU 内核上去执行，这多个任务是真正的同时执行。并行需要有物理层面的支持，即需要多核处理器（可以是多个 CPU，甚至在分布式集群中可以是多台物理机）。如下图所示：
![](https://github.com/yongjianmeng/blog/blob/master/images/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C%E7%9A%84%E5%8C%BA%E5%88%AB-1.png)

## 区别 ##
Erlang 的发明者 Joe Armstrong 曾在一篇文章中提到*如何向一个 5 岁的小孩去介绍并发和并行的区别*，他用到了下面这张图：
![](https://github.com/yongjianmeng/blog/blob/master/images/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C%E7%9A%84%E5%8C%BA%E5%88%AB-2.jpg)  
他认为并发就是两个队列交替使用同一台咖啡机，而并行就是两个队列各自使用一台咖啡机。  
[知乎上](https://www.zhihu.com/question/33515481/answer/58849148)有人这么理解，我觉得也非常地通俗易懂：  

- *你吃饭吃到一半，电话来了，你一直到吃完了以后才去接，这就说明你不支持并发也不支持并行。*（只支持串行）。
- *你吃饭吃到一半，电话来了，你停了下来接了电话，接完后继续吃饭，这说明你支持并发。*（需要代码层面的支持）
- *你吃饭吃到一半，电话来了，你一边打电话一边吃饭，这说明你支持并行。*（需要代码和硬件层面的支持）

**并发的关键是你有处理多个任务的能力，不一定要同时。并行的关键是你有同时处理多个任务的能力。**

## 关联 ##

从吃饭和接电话的那个例子中，我们可以总结出**并行概念是并发概念的一个子集**。可以举个例子来理解，假如我们编写了一个拥有多个线程的并发程序：

- 如果这个程序由单核处理器来执行，那么它就不能以并行方式来运行，只能在单核处理器上交替执行。
- 如果这个程序由多核处理器来执行，那么它就能以并行的方式来运行。如果线程太多，那么在多核处理器的每个核上就有可能出现交替执行。

## 总结 ##
其实还能从不同的角度来理解并发与并行的区别，但篇幅有限，不能展开阐述，有问题欢迎提交 PR 讨论。